import org.gradle.internal.os.OperatingSystem

if (OperatingSystem.current().isWindows()) {

	task pathingJar(type: Jar) {
		dependsOn configurations.runtime
		appendix = 'pathing'

		doFirst {
			manifest {
				attributes 'Class-Path': configurations.runtime.files.collect {
					it.toURL().toString().replaceFirst(/file:\/+/, '/')
				}.join(' ')
			}
		}

		// assetCompile will be execute for all Jar-type tasks
		// (see https://github.com/bertramdev/asset-pipeline/blob/master/asset-pipeline-gradle/src/main/groovy/asset/pipeline/gradle/AssetPipelinePlugin.groovy#L85)
		// at least exclude the assets from pathing jar
		exclude { it.file.absolutePath.contains('assetCompile') }
	}

	bootRun {
		dependsOn pathingJar
		doFirst {
			classpath = files("$buildDir/classes/main", "$buildDir/resources/main", pathingJar.archivePath)
		}
	}
}
